name: build
on: [pull_request, push]
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      name: "math-parser"
    steps:
      - name: checkout code
        uses: actions/checkout@v2

      - name: Configure Java 17
        uses: actions/setup-java@v2
        with:
          distribution: "adopt"
          java-version: "17"

      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@417ae3ccd767c252f5661f1ace9f835f9654f2b5 # v3.1.0

      - name: gradle check
        run: gradle check

      - name: gradle run test
        run: gradle test

      - name: gradle build
        run: gradle build

      - name: create release
        uses: softprops/action-gh-release@v1
        with:
          files: build/libs/*
          tag_name: 1.0.0
          name: math-parser-1.0.0
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}

      - name: Import GPG key
        run: |
            echo "${{ secrets.SIGNING_KEY }}" | gpg --import
            echo "trust" | gpg --command-fd 0 --edit-key 902DE4403743438E trust
            echo "5"  # set trust level to ultimate
            echo "y"  # confirm
            echo "quit"
        env:
            GPG_KEY: ${{ secrets.SIGNING_KEY }}

      - name: gradle publish
        run: gradle publish
        env:
         USERNAME: ${{ secrets.SONATYPE_USER }}
         PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
         signing.password: ${{ secrets.SIGNING_PASSWORD }}
         signing.secretKeyRingFile: ${{ secrets.SIGNING_KEY }}




